select temp.uid, stock_rain_user.nick, temp.time, temp.p from (select prize.uid as uid, sum(CASE WHEN index.market = 'HK' THEN prize.price * 1 ELSE prize.price * 7.8 END) as p, from_unixtime(prize.created_at, '%Y-%m-%d') as time from stock_rain_prize as `prize`, stock_rain_index as `index` where prize.chance > 0 and prize.stock >= 1 and index.id = prize.stock and prize.created_at > unix_timestamp('2018-10-18 00:00:00') and prize.created_at < unix_timestamp('2018-10-19 00:00:00') group by prize.uid order by p desc limit 3) as `temp`, stock_rain_user where stock_rain_user.uid = temp.uid;
